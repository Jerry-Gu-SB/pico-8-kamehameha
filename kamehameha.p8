pico-8 cartridge // http://www.pico-8.com
version 42
__lua__

-- Ultra Instinct Theme (From "Dragon Ball Super") by Norihito Sumitomo
-- Notes taken from the MIDI transcription by Deadbeet
-- https://onlinesequencer.net/1993848
KAMEHAMEHA_STARTUP_FRAMES = 10
function _init()
    objects = {}
    player = {
        x = 24,
        y = 24,
        dx = 0,
        dy = 0,
        frame = 0,
        update = update_player,
        draw = draw_player,
    }
end

function _update()
    update_player()
    update_music()
    update_objects()
    update_button_4()
end

function update_button_4()
    if btnp(4) then
        new_kamehameha(player.x, player.y, 0, 0)
        player.frame = 1
    end
end

function update_objects()
    for i = #objects, 1, -1 do
        if not objects[i]:update() then
            del(objects, objects[i])
        end
    end
end

function update_music()
    if not stat(57) then
        music(0)
    end
end

function update_player()
    if player.frame > 0 then player.frame += 1 end
    if player.frame > 20 then player.frame = 0 end

    if btn(‚¨ÖÔ∏è) then player.dx -= 1 end
    if btn(‚û°Ô∏è) then player.dx += 1 end
    if btn(‚¨ÜÔ∏è) then player.dy -= 1 end
    if btn(‚¨áÔ∏è) then player.dy += 1 end

    player.x += player.dx
    player.y += player.dy

    player.dx *= 0.7
    player.dy *= 0.7
end

function update_kamehameha(k)
    k.frame += 1
    if k.frame == KAMEHAMEHA_STARTUP_FRAMES then
        k.x = player.x + 10
        k.y = player.y
        player.dx -= 6
    end
    return k.frame < 50
end

function _draw()
    cls()
    map()
    draw_player()

    print("press üÖæÔ∏è to kamehamehaaaaaaaaaaaaaa", 2, 2, 7)
    
    for obj in all(objects) do
        obj:draw()
    end
end

function draw_player()
    if 1 < player.frame and player.frame <= 4 then
        spr(3, player.x, player.y, 2, 2)
    elseif 4 < player.frame and player.frame <= 8 then
        spr(5, player.x, player.y, 2, 2)
    elseif 8 < player.frame and player.frame <= 20 then
        spr(7, player.x, player.y, 2, 2)
    else
        spr(1, player.x, player.y, 2, 2)
    end
end

function draw_kamehameha(k)
    laser_gap = 7
    frame_gap = 3
    if k.frame > KAMEHAMEHA_STARTUP_FRAMES then
        spr(9, k.x, k.y, 2, 2)
    end

    for i = 1, 4 do
        if k.frame > (i + 1) * frame_gap + KAMEHAMEHA_STARTUP_FRAMES then
            spr(11, k.x + i * laser_gap, k.y, 1, 2)
        end
    end

    if k.frame > 5 * frame_gap  + KAMEHAMEHA_STARTUP_FRAMES then
        spr(12, k.x + 5 * laser_gap, k.y, 1, 2)
    end
end

function new_kamehameha(start_x, start_y, dx, dy)
    local k = {
        x = start_x,
        y = start_y,
        dx = 0,
        dy = 0,
        frame = 0,
        update = update_kamehameha,
        draw = draw_kamehameha,
    }
    add(objects, k)
end  


__gfx__
00000000000000000000000000000000000000000a000000000000000a0a0000000000000a000000000aaaa0000aaa0a0000000a000077777777000000000000
0000000000000000000000000000000000000000aaaaaa0000000000a9aacaa0000000000a70000a0ccccccaccaacaa7aa000aaa000788888877700000000000
0000000000000000000000000000aaa0000000000acaaaa0000000000acaa9aa0000000000a7a0a0caaccccccaac7cccc00077a0007887777887770000000000
000000000000000000000000000aaaaaa0000000aaaaaaaa00000000acaacaaaa00000000000a00ccc66aacccc6cccc767caa000078878888788777000000000
000000000000000000000000000aaaaaa0000000aacaacaaa00000000accacaaa000000000ccccc6aaaccc6ccaccaaac66666000078787777878777700000000
000000000000777770000000000a7777700000000aaaaaaaa00cc000aca9aaaaa00000000cccc66cccccaacc6ccccccccccccc00787887887887877700000000
00000000000077717000000000007771700000000c00a77170cc00000ac0777170000700ccccccaaaac7777777a77aaccaaaacc0787878778787877700000000
00000000000077777000000000007777700000000ccc77777cc00000a000777770007700c6666cccccccc7ccaacaaaa7777ccccc787878778787877700000000
0000000000000070000000000000007000000000000c0070cc0000000000007000007000cccaa777caaac76ccc77cccccaaaaaaa787878778787877700000000
00000000000000700000000000006670000000000a00007cc00000000000007777777000ccc6ccccccaa77776aaac6ccccc777cc787878778787877700000000
000000000000007070000000660060700000000000007770000000000000007000007000cccc6cc6aaccccc6c7c7caaac77aacac787887887887877700000000
000000000000007770000000066007700000000006607070000000000000007000000700cc7c7cccccccaaaaccc6cccc6cccccc0078787777878777700000000
0000000000000070000000000060707000000000000077700c00000000000070000007000ccaacaac6ca6ccccaa7ccccccccac00078878888788777000000000
000000000000077700000000666007770000000000cc07770ccc00000000077700000000000a0ccacca6acccc776acacccacc000007887777887770000000000
00000000000077070000000060660707000000000ca07707000cccc0000077070000000007a700c0cccc6cca0ccc6ccca000a000000788888877700000000000
0000000000077007700000000006670770000000000770077000000000077007700000000000000c0a000aa0aa000a00aaa0000a000077777777000000000000
00000000000550000006600000448880000000000044988080000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000706607007077070044a9988880000000449a98898888000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000066000007777004546aaa888000000454aaa88aaa98880000000000000000000000000000000000000000000000000000000000000000000000000
00000000566776656776677645444a99998888004544aaaaa9aaaa98000000000000000000000000000000000000000000000000000000000000000000000000
00000000566776656776677644544aaaaa9a998844544aa8a99a8880000000000000000000000000000000000000000000000000000000000000000000000000
00000000000660000077770045445a9988880000454459a998888000000000000000000000000000000000000000000000000000000000000000000000000000
00000000070660700707707044644998800000004464499888800000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000550000006600004498880000000000449988000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000011000a011110a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a1aa1a0011aa11000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001aaaa1011aaaa1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001aaaaaa11aaaaaa100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000001aaaaaa11aaaaaa100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000001aaaa1011aaaa1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000a1aa1a0011aa11000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000011000a011110a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3838383838383838383838383838363800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383832383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383622383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838382234353538383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383832383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838332238383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383438383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838382138383538383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838382138383833383638383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3838383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3833383838383838383838383838383800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000353838000038380000003838380000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
0004010c384503645035450334502e4502d4502c4502c4502b4502a4502a450000000000030450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00250212000000000000000390500000037050000003a0500000039050000003705000000350500000034050000003505000000000000000000000000000000000000000002e0500000000000000000000000000
002502120000000000000000d050000000d050000000d050000000d050000000e050000000e050000000e050000000e0500000000000000000000000000000000000000000000000000000000000000000000000
002502120000000000000001505000000150500000015050000001505000000150500000015050000001505000000150500000000000000000000000000000000000000000000000000000000000000000000000
__music__
00 01020344

