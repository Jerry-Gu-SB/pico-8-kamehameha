pico-8 cartridge // http://www.pico-8.com
version 42
__lua__


x = 24
y = 24
dx = 0
dy = 0

kamehameha_frame = 0
objects = {}

function draw_player()
    if 1 < kamehameha_frame and kamehameha_frame <= 4 then
        spr(3, x, y, 2, 2)
    elseif 4 < kamehameha_frame and kamehameha_frame <= 8 then
        spr(5, x, y, 2, 2)
    elseif 8 < kamehameha_frame and kamehameha_frame <= 20 then
        spr(7, x, y, 2, 2)
    else
        spr(1, x, y, 2, 2)
    end
end

function draw_kamehameha(k)
    laser_gap = 8
    frame_gap = 7
    if k.frame > frame_gap then
        spr(9, k.x, k.y, 2, 2)
    end

    for i = 1, 5 do
        if k.frame > (i + 1) * frame_gap then
            spr(11, k.x + i * laser_gap, k.y, 1, 2)
        end
    end

    if k.frame > 6 * frame_gap then
        spr(12, k.x + 5 * laser_gap, k.y, 1, 2)
    end
end

function update_kamehameha(k)
    k.frame += 1
    k.x += k.dx
    k.y += k.dy
    return k.frame < 50 -- Remove the Kamehameha after 50 frames
end

function new_kamehameha(start_x, start_y, dx, dy)
    local k = {
        x = start_x + 10, -- Offset to appear in front of the player
        y = start_y, -- Slight vertical offset
        dx = 0,
        dy = 0,
        frame = 0,
        update = update_kamehameha,
        draw = draw_kamehameha,
    }
    add(objects, k)
end

function _draw()
    cls() -- Clear the screen
    map()
    draw_player()

    print("Press ðŸ…¾ï¸ to KAMEHAMEHAAAAAAAAAAA", 2, 2, 7)
    for obj in all(objects) do
        obj:draw()
    end
end

function move()
    if btn(â¬…ï¸) then dx -= 1 end
    if btn(âž¡ï¸) then dx += 1 end
    if btn(â¬†ï¸) then dy -= 1 end
    if btn(â¬‡ï¸) then dy += 1 end

    x += dx
    y += dy

    dx *= 0.7
    dy *= 0.7
end

function _update()
    move()

    -- Trigger Kamehameha animation and laser
    if btnp(4) and kamehameha_frame == 0 then
        kamehameha_frame = 1
    end

    -- Handle Kamehameha animation
    if kamehameha_frame > 0 then
        kamehameha_frame += 1

        -- Launch a laser at frame 8
        if kamehameha_frame == 8 then
            new_kamehameha(x, y, 2, 0)
        end

        if kamehameha_frame > 50 then
            kamehameha_frame = 0
        end
    end

    -- Update objects and clean up expired ones
    for i = #objects, 1, -1 do
        if not objects[i]:update() then
            del(objects, objects[i])
        end
    end
end
   


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000077777777000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000788888877700000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007887777887770000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000078878888788777000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000078787777878777700000000
0000000000007777700000000000777770000000000077777000000000007777700000000000000a0000a000000000a000000a00787887887887877700000000
000000000000777770000000000077777000000000007777700000000000777770000000000000a0000a00000a00000a0000a000787878778787877700000000
0000000000007777700000000000777770000000000077777000000000007777700000000000000a0000a00000a000a000000a00787878778787877700000000
00000000000000700000000000000070000000006000007000000000000000700000000000000cc66ccccc6cc6cccccccccccc00787878778787877700000000
000000000000007000000000000000700000000066000070000000000000007000000000000cccccccaaaaccc77a77aaccaaaac0787878778787877700000000
000000000000007070000000000000700000000000007770000000000000007000070000ccccccaaaa777777caacaaaa7777ccc0787887887887877700000000
00000000000000777000000000000770000000006660707000000000000000777777000cc6666cccccccccccccc77cccccaaaaa0078787777878777700000000
000000000000007000000000000070700000000000007770000000000000007000070000cccc7777caaacc6cc6aaac6ccccc7770078878888788777000000000
000000000000077700000000000007770000000066000777000000000000077700000000000cccccaaaa7777cc7c7caaac77aac0007887777887770000000000
00000000000077070000000000000707000000006000770700000000000077070000000000000cc6ccccccc6cccc6cccc6cccc00000788888877700000000000
000000000007700770000000000007077000000000077007700000000007700770000000000000a0000a0000000a000000000a00000077777777000000000000
0000000033333333bb33b3333333533333333553333b333333333333000000000000000000000000000000000000000000000000000000000000000000000000
0000000033bb333bb333b33333bb533bbbbb35333bbb3353333b3335000000000000000000000000000000000000000000000000000000000000000000000000
000000003bb333bb3333b3333bb3333333553b333b33335533bb3355000000000000000000000000000000000000000000000000000000000000000000000000
0000000033b333333333bb333bb3333355533bb3333333353bb33353000000000000000000000000000000000000000000000000000000000000000000000000
000000003333b333bb333b3333bb33b353bbbb3335333b3533333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000333bb3333bb33333333bb3bbbbb333333333bb3333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000553b333333b333533333b333333333333b3bb3333333b333000000000000000000000000000000000000000000000000000000000000000000000000
00000000533b335533b333533533333b33333b333bbb333333333bb3000000000000000000000000000000000000000000000000000000000000000000000000
000000003333355333bb33533533553bb3333b33bb333333355533b3000000000000000000000000000000000000000000000000000000000000000000000000
00000000333335333333355335333533bb333bb33333b33333333335000000000000000000000000000000000000000000000000000000000000000000000000
000000003bb333bb333b3b33333b35333bbb3333553bbb333b333335000000000000000000000000000000000000000000000000000000000000000000000000
0000000033b33bb3333b3b3333bb33333bbb333353333bbbbb355533000000000000000000000000000000000000000000000000000000000000000000000000
0000000033b33b33333b3bb333b333333333353333b3333bb33333b3000000000000000000000000000000000000000000000000000000000000000000000000
0000000033b33b33553b33b3333333bbbb33355333b3333333333bb3000000000000000000000000000000000000000000000000000000000000000000000000
000000003335533335533333533bb33335533353bbb35553bbbbbb33000000000000000000000000000000000000000000000000000000000000000000000000
00000000333355333355333353bb3333553335533333333333b33353000000000000000000000000000000000000000000000000000000000000000000000000
__map__
3225312134312634263125352525362500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3226343433212132263626322635232500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2226223426322235343522322626233600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2226323432263622332635243533232600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3124223424263235352234353526262300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3232322226322626222626353633262500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3124343131332433233432222526243600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3432312431243324252335332236262300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3123243423242325253432322333253500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2433332123213233232132213536243200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636323232332124213633323623243100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3223323533312421322323362332213600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3223312432322323243223333624322400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3536322333213633353221323231213500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3126223126222521312124223123213600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626262423252225242324242524242400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2223242433262125352625262326243600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2626242623343426342535262621352400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3533332623262424262331352323352100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000350000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000101000000000000231502315026150291502c1502f15033150371402915036150361502115011150311502f1501f1501a15027150000003215000000000001e150000000000000000000002a1500000000000
